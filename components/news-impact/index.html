<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>News Impact – Carousel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#f7f8fb;--card:#fff;--ink:#0f172a;--muted:#64748b;
      --border:#e5e7eb;--btn:#0ea5e9;--pos:#059669;--neu:#64748b;--neg:#dc2626;
      --ring:rgba(14,165,233,.25)
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);
      font:400 16px/1.5 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1152px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 8px;font-size:clamp(22px,2.2vw,28px)}
    .hint{color:var(--muted);margin-bottom:18px}
    .carousel{display:grid;grid-auto-flow:column;gap:16px;overflow:auto;
      scroll-snap-type:x mandatory;padding:2px 2px 10px;-webkit-overflow-scrolling:touch}
    .carousel::-webkit-scrollbar{height:10px}
    .carousel::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:999px}
    .item{scroll-snap-align:center;min-width:min(520px,90vw)}
    .card{background:var(--card);border:1px solid var(--border);
      border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(2,6,23,.07);
      display:flex;flex-direction:column;gap:10px}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .company{font-weight:700;font-size:clamp(16px,1.6vw,18px)}
    .summary{color:var(--muted)}
    .impact b{font-weight:700}
    .chip{border-radius:999px;padding:6px 10px;font-size:12px;font-weight:600;
      background:#f1f5f9;border:1px solid #e2e8f0;color:#0f172a}
    .chip.pos{background:rgba(5,150,105,.1);color:var(--pos)}
    .chip.neu{background:rgba(100,116,139,.1);color:var(--neu)}
    .chip.neg{background:rgba(220,38,38,.1);color:var(--neg)}
    .controls{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
    button.nav{border:1px solid var(--border);background:#fff;border-radius:12px;
      padding:8px 12px;cursor:pointer;font-weight:600}
    a.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;
      font-weight:600;text-decoration:none;background:var(--btn);color:#fff;
      border-radius:12px;border:1px solid var(--btn)}
    @media(max-width:640px){.item{min-width:92vw}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>News Impact</h1>
    <div class="hint">Company, sentiment, score, and summary.</div>
    <div class="controls">
      <button class="nav" id="prevBtn">⟵ Prev</button>
      <button class="nav" id="nextBtn">Next ⟶</button>
    </div>
    <div id="carousel" class="carousel"></div>
  </div>

  <script>
    const $ = s=>document.querySelector(s);
    const esc = s=>String(s??"").replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
    const sentimentClass=s=>/pos/i.test(s)?'pos':/neg/i.test(s)?'neg':'neu';
    const clamp=x=>Math.max(0,Math.min(10,Number(x)||0));
    const pct=s=>`${s*10}%`;

    /** Build each news card */
    function buildCard(doc){
      const company = doc?.company || "";
      const symbol = doc?.symbol || "";
      const snt = doc?.sentiment || "Neutral";
      const score = clamp(doc?.score);
      const impact = doc?.impact || "";
      const summary = doc?.summary || "";
      const link = doc?.news_link || "#";
      const dt = doc?.dt || "";

      const div=document.createElement("div");
      div.className="item";
      div.innerHTML=`
        <article class="card">
          <div class="row">
            <div class="company">${esc(company)} (${esc(symbol)})</div>
            <span class="chip ${sentimentClass(snt)}">${esc(snt)}</span>
          </div>
          <div class="summary">${esc(summary)}</div>
          <div class="impact"><b>Impact:</b> ${esc(impact)}</div>
          <div class="impact"><b>Score:</b> ${score}/10</div>
          <div class="impact"><b>Date:</b> ${esc(dt)}</div>
          <div class="row" style="justify-content:space-between;margin-top:6px">
            <a class="btn" href="${encodeURI(link)}" target="_blank" rel="noopener noreferrer">Open news</a>
          </div>
        </article>`;
      return div;
    }

    /** Render list of cards */
    function render(list){
      const host=$("#carousel");
      host.innerHTML="";
      (list||[]).forEach(d=>host.appendChild(buildCard(d)));
    }

    /** Initialize widget data connection */
    function init(){
      // prefer structuredContent from MCP
      const sc = window.structuredContent;
      if(Array.isArray(sc?.docs)&&sc.docs.length) return render(sc.docs);
      if(Array.isArray(sc?.items)&&sc.items.length) return render(sc.items);

      // subscribe to updates from host
      if(window.openai?.onStructuredContentChanged)
        window.openai.onStructuredContentChanged(sc=>render(sc.docs||sc.items||[]));

      // fallback (no data yet)
      render([{company:"No data",impact:"",score:0,sentiment:"Neutral",summary:"No results found."}]);
    }

    window.addEventListener("DOMContentLoaded",init);

    // simple nav scroll
    $("#nextBtn").onclick=()=>$("#carousel").scrollBy({left:520,behavior:"smooth"});
    $("#prevBtn").onclick=()=>$("#carousel").scrollBy({left:-520,behavior:"smooth"});
  </script>
</body>
</html>
